<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ultimate Calculator</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Poppins:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; }
    :root {
      --bg-color: #2d472c;
      --container-bg: #1a2e1a;
      --text-color: #e5e2d7;
      --result-color: #d1e231;
      --hint-color: #a3cfa5;
      --history-bg: #0f1c0f;
      --clear-btn-bg: #7a0b0b;
      --lcd-screen: #213b2a;
      --lcd-border: #476146;
    }
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom right, var(--bg-color), #0d1e12);
      color: var(--text-color);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      width: 95%;
      max-width: 800px;
      padding: 2rem;
      background: var(--container-bg);
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    h1 {
      text-align: center;
      font-family: 'Fira Code', monospace;
      font-size: 2rem;
      color: var(--result-color);
    }
    select, textarea, button, input {
      width: 100%;
      padding: 1rem;
      font-size: 1.2rem;
      border-radius: 8px;
      border: 2px solid var(--lcd-border);
      font-family: 'Fira Code', monospace;
      background-color: #fff;
      color: #000;
    }
    button {
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    button:hover {
      transform: translateY(-2px);
      background-color: var(--result-color);
      color: var(--container-bg);
    }
    .result {
      font-weight: bold;
      font-size: 1.4rem;
      background-color: var(--lcd-screen);
      border: 2px solid var(--lcd-border);
      padding: 1rem;
      border-radius: 8px;
      white-space: pre-wrap;
    }
    .history {
      background: var(--history-bg);
      padding: 1.5rem;
      border-radius: 8px;
      max-height: 400px;
      overflow-y: auto;
      color: #fff;
      font-size: 1.1rem;
      line-height: 1.6;
      font-family: 'Fira Code', monospace;
      border: 2px solid var(--lcd-border);
    }
    .history div {
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px dashed #4a5c49;
    }
    .clear-btn {
      background-color: var(--clear-btn-bg);
      color: white;
      border: none;
      padding: 0.7rem;
      cursor: pointer;
      border-radius: 6px;
    }
    #unitUI {
      display: none;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }
    #unitUI select, #unitUI input {
      flex: 1 1 30%;
    }
    .theme-toggle {
      position: absolute;
      top: 1rem;
      right: 1rem;
      z-index: 10;
    }
    /* Show gender/height inputs inline and label styling */
    .inline-label {
      display: inline-block;
      margin-top: 1rem;
      margin-bottom: 0.3rem;
      color: var(--text-color);
      font-weight: bold;
      font-family: 'Fira Code', monospace;
      font-size: 1rem;
    }
    #gender, #height {
      width: 100%;
      max-width: 150px;
      margin-bottom: 1rem;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.js"></script>
</head>
<body>
  <div class="theme-toggle">
    <select id="themeSwitcher" onchange="switchTheme()">
      <option value="zelda">Zelda</option>
      <option value="light">Light</option>
      <option value="dark">Dark</option>
    </select>
  </div>
  <div class="container">
    <h1>Ultimate Calculator</h1>
    <select id="calcType" onchange="updatePlaceholder()">
      <option value="basic">Basic Math</option>
      <option value="calculus">Calculus</option>
      <option value="solve">Simplify Expression</option>
      <option value="convert">Unit Conversion</option>
      <option value="macro">Macro Estimator</option>
      <option value="fuel">Fuel Cost Estimator</option>
      <option value="time">Time Clock</option>
    </select>

    <!-- Gender and Height inputs -->
    <label for="gender" id="gender-label" class="inline-label" style="display:none;">Gender:</label>
    <select id="gender" style="display:none;">
      <option value="male">Male</option>
      <option value="female">Female</option>
      <option value="other">Other / Prefer not to say</option>
    </select>

    <label for="height" id="height-label" class="inline-label" style="display:none;">Height (inches):</label>
    <input type="number" id="height" placeholder="e.g. 70" min="36" max="96" style="display:none;" />

    <textarea id="input1" rows="3" placeholder="Enter input..."></textarea>
    <div id="unitUI">
      <input type="number" id="unitValue" placeholder="Enter value" />
      <select id="fromUnit"></select>
      to
      <select id="toUnit"></select>
      <button onclick="convertViaDropdown()">Convert</button>
    </div>
    <div class="hint" id="inputHint"></div>
    <button onclick="calculate()">ðŸ§® Calculate</button>
    <div class="result" id="result"></div>
    <div class="history" id="history"></div>
    <button class="clear-btn" onclick="clearHistory()">Clear History</button>
  </div>
  <script>
    const unitCategories = {
      Length: ["mm", "cm", "m", "km", "in", "ft", "yd", "mi"],
      Mass: ["mg", "g", "kg", "oz", "lb", "ton"],
      Time: ["ms", "s", "min", "h", "day"],
      Volume: ["ml", "l", "tsp", "Tbs", "cup", "pt", "qt", "gal"],
      Temperature: ["degC", "degF", "K"],
      Area: ["m^2", "cm^2", "ft^2", "in^2", "acre", "ha"],
      Speed: ["m/s", "km/h", "mph", "knot"]
    };

    const allUnits = Object.values(unitCategories).flat();

    function populateUnitDropdowns() {
      const fromSelect = document.getElementById("fromUnit");
      const toSelect = document.getElementById("toUnit");
      fromSelect.innerHTML = "";
      toSelect.innerHTML = "";

      for (const [category, units] of Object.entries(unitCategories)) {
        const optGroupFrom = document.createElement("optgroup");
        const optGroupTo = document.createElement("optgroup");
        optGroupFrom.label = category;
        optGroupTo.label = category;

        units.forEach(unit => {
          const optionFrom = document.createElement("option");
          const optionTo = document.createElement("option");
          optionFrom.value = optionTo.value = unit;
          optionFrom.textContent = optionTo.textContent = unit;
          optGroupFrom.appendChild(optionFrom);
          optGroupTo.appendChild(optionTo);
        });

        fromSelect.appendChild(optGroupFrom);
        toSelect.appendChild(optGroupTo);
      }
    }

    function switchTheme() {
      const theme = document.getElementById('themeSwitcher').value;
      const root = document.documentElement;
      const themes = {
        zelda: {
          '--bg-color': '#2d472c',
          '--container-bg': '#1a2e1a',
          '--text-color': '#e5e2d7',
          '--result-color': '#d1e231',
          '--hint-color': '#a3cfa5',
          '--history-bg': '#0f1c0f',
          '--clear-btn-bg': '#7a0b0b',
        },
        light: {
          '--bg-color': '#f0f0f0',
          '--container-bg': '#ffffff',
          '--text-color': '#222222',
          '--result-color': '#007700',
          '--hint-color': '#555555',
          '--history-bg': '#e0e0e0',
          '--clear-btn-bg': '#cccccc',
        },
        dark: {
          '--bg-color': '#1a1a1a',
          '--container-bg': '#2a2a2a',
          '--text-color': '#eeeeee',
          '--result-color': '#66ff66',
          '--hint-color': '#999999',
          '--history-bg': '#333333',
          '--clear-btn-bg': '#444444',
        }
      };
      const vars = themes[theme];
      for (let key in vars) {
        root.style.setProperty(key, vars[key]);
      }
    }

    function updatePlaceholder() {
      const type = document.getElementById('calcType').value;
      const inputBox = document.getElementById('input1');
      const hint = document.getElementById('inputHint');

      const examples = {
        basic: "e.g. 2 + 2 * 3",
        calculus: "e.g. d/dx(x^2 + 3x)",
        solve: "e.g. simplify (2x^2 + 4x - 2x^2)",
        convert: "e.g. 5 inch to cm",
        macro: "Enter your weight in lbs, gender, and optionally height",
        fuel: "e.g. 120 20 3.75 (miles mpg cost/gal)",
        time: "e.g. 7.5 16 (worked hrs & goal) or 7.5 16 13:00 (current time)"
      };

      if (type === 'macro') {
        inputBox.placeholder = 'Weight in lbs (e.g. 180)';
        hint.textContent = 'Enter weight, select gender, and optionally enter height';
        document.getElementById('gender').style.display = 'inline-block';
        document.getElementById('gender-label').style.display = 'inline-block';
        document.getElementById('height').style.display = 'inline-block';
        document.getElementById('height-label').style.display = 'inline-block';
      } else {
        inputBox.placeholder = examples[type] || 'Enter input...';
        hint.textContent = examples[type] || '';
        document.getElementById('gender').style.display = 'none';
        document.getElementById('gender-label').style.display = 'none';
        document.getElementById('height').style.display = 'none';
        document.getElementById('height-label').style.display = 'none';
      }

      document.getElementById('unitUI').style.display = type === 'convert' ? 'flex' : 'none';
    }

    function calculate() {
      const type = document.getElementById('calcType').value;
      const input = document.getElementById('input1').value.trim();
      const resultBox = document.getElementById('result');
      try {
        let result = '';
        if (type === 'basic') {
          result = `Result: ${math.evaluate(input)}`;
        } else if (type === 'calculus') {
          const match = input.match(/d\/d(\w+)\((.*)\)/);
          if (match) {
            const [, variable, expression] = match;
            const derivative = math.derivative(expression, variable);
            result = `d/d${variable}(${expression}) = ${derivative.toString()}`;
          } else {
            throw new Error('Use format d/dx(expression)');
          }
        } else if (type === 'solve') {
          result = `Simplified: ${math.simplify(input).toString()}`;
        } else if (type === 'convert') {
          const [value, from, , to] = input.split(' ');
          const converted = math.unit(parseFloat(value), from).to(to);
          result = `${value} ${from} = ${converted.toString()}`;
        } else if (type === 'macro') {
          const weight = parseFloat(input);
          const gender = document.getElementById('gender').value;
          const height = parseFloat(document.getElementById('height').value);

          if (isNaN(weight) || weight <= 0) throw new Error("Please enter a valid weight");

          // Protein multipliers by gender
          let proteinPerLb;
          if (gender === 'male') proteinPerLb = 1.1;
          else if (gender === 'female') proteinPerLb = 0.9;
          else proteinPerLb = 1.0;

          // Optional: Slight height adjustment (just example, can be improved)
          let heightAdj = 1.0;
          if (!isNaN(height)) {
            if (height < 60) heightAdj = 0.9;
            else if (height > 75) heightAdj = 1.1;
          }

          const protein = weight * proteinPerLb * heightAdj;
          const fat = weight * 0.4 * heightAdj;
          const carbs = weight * 2 * heightAdj;

          result = `Protein: ${protein.toFixed(1)}g\nFat: ${fat.toFixed(1)}g\nCarbs: ${carbs.toFixed(1)}g`;
        } else if (type === 'fuel') {
          const [miles, mpg, cost] = input.split(' ').map(parseFloat);
          if ([miles, mpg, cost].some(isNaN)) throw new Error("Invalid input");
          const totalCost = (miles / mpg) * cost;
          result = `${miles} miles @ ${mpg} mpg @ $${cost}/gal = $${totalCost.toFixed(2)}`;
        } else if (type === 'time') {
          const parts = input.split(' ');
          if (parts.length === 2) {
            const start = parseFloat(parts[0]);
            const end = parseFloat(parts[1]);
            if (isNaN(start) || isNaN(end)) throw new Error("Invalid input");
            const remaining = (end - start).toFixed(2);
            const completedPct = ((start / end) * 100).toFixed(1);
            const minutesRemaining = Math.round(remaining * 60);
            const now = new Date();
            const offTime = new Date(now.getTime() + minutesRemaining * 60000);
            const hrs = Math.floor(minutesRemaining / 60);
            const mins = minutesRemaining % 60;
            result = `${remaining} hours remaining (approx. ${hrs}h ${mins}m)\nYouâ€™ve completed about ${completedPct}% of your shift.\nIf you keep working, youâ€™ll be off at: ${offTime.toLocaleTimeString()}`;
          } else if (parts.length === 3) {
            const [worked, goal, current] = parts;
            const [h, m] = current.split(':').map(Number);
            if (isNaN(worked) || isNaN(goal) || isNaN(h) || isNaN(m)) throw new Error("Invalid input");
            const currentTime = new Date();
            currentTime.setHours(h);
            currentTime.setMinutes(m);
            currentTime.setSeconds(0);
            const workedHours = parseFloat(worked);
            const goalHours = parseFloat(goal);
            const remainingHours = goalHours - workedHours;
            const completedPct = ((workedHours / goalHours) * 100).toFixed(1);
            const startTime = new Date(currentTime.getTime() - workedHours * 60 * 60 * 1000);
            const endTime = new Date(startTime.getTime() + goalHours * 60 * 60 * 1000);
            const hrs = Math.floor(remainingHours);
            const mins = Math.round((remainingHours % 1) * 60);
            result = `Youâ€™ve worked ${workedHours.toFixed(2)} hrs out of ${goalHours} hrs.\nProgress: ${completedPct}%.\nTime remaining: ${hrs}h ${mins}m.\nEstimated clock-out time: ${endTime.toLocaleTimeString()}`;
          } else {
            throw new Error('Invalid time input.');
          }
        } else {
          throw new Error('Unknown calculation type.');
        }
        resultBox.textContent = result;
        addToHistory(`${type}: ${result}`);
      } catch (err) {
        const errorMsg = `Error: ${err.message}`;
        resultBox.textContent = errorMsg;
        addToHistory(`${type}: ${errorMsg}`);
      }
    }

    function convertViaDropdown() {
      const from = document.getElementById('fromUnit').value;
      const to = document.getElementById('toUnit').value;
      const val = parseFloat(document.getElementById('unitValue').value);
      const resultBox = document.getElementById('result');
      try {
        if (isNaN(val)) throw new Error("Enter a valid number");
        const converted = math.unit(val, from).to(to);
        const result = `${val} ${from} = ${converted.toString()}`;
        resultBox.textContent = result;
        addToHistory(`convert: ${result}`);
      } catch (err) {
        const errorMsg = `Error: ${err.message}`;
        resultBox.textContent = errorMsg;
        addToHistory(`convert: ${errorMsg}`);
      }
    }

    function addToHistory(entry) {
      const historyBox = document.getElementById('history');
      const div = document.createElement('div');
      div.textContent = entry;
      historyBox.prepend(div);
    }

    function clearHistory() {
      document.getElementById('history').innerHTML = '';
    }

    window.addEventListener("DOMContentLoaded", () => {
      updatePlaceholder();
      populateUnitDropdowns();
      const fromUnit = document.getElementById("fromUnit");
      fromUnit.addEventListener("change", () => {
        const selected = fromUnit.value;
        const toUnit = document.getElementById("toUnit");
        toUnit.innerHTML = "";
        allUnits.forEach(unit => {
          try {
            math.unit(1, selected).to(unit);
            const opt = document.createElement("option");
            opt.value = opt.textContent = unit;
            toUnit.appendChild(opt);
          } catch {}
        });
      });
    });
  </script>
</body>
</html>
